<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Finanz-Tracker</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#111111" />
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; max-width: 520px; }
    label { display:block; margin-top: 12px; font-weight: 600; }
    input, select, textarea, button { width:100%; padding:12px; margin-top:6px; font-size: 16px; }
    button { margin-top: 16px; }
    .row { display:flex; gap:12px; }
    .row > div { flex:1; }
    .msg { margin-top: 12px; }
  </style>
</head>
<body>
  <h2>Neue Buchung</h2>

  <form id="f">
    <label>Typ</label>
    <select id="typ" required>
      <option value="Ausgabe">Ausgabe</option>
      <option value="Einnahme">Einnahme</option>
    </select>

    <label>Betrag (€)</label>
    <input id="betrag" type="number" step="0.01" required />

    <label>Kategorie</label>
    <select id="kategorie" required>
      <option>Wohnen</option>
      <option>Lebensmittel & Haushalt</option>
      <option>Essen außer Haus</option>
      <option>Transport & Mobilität</option>
      <option>Versicherungen</option>
      <option>Kommunikation</option>
      <option>Abos & Mitgliedschaften</option>
      <option>Gesundheit</option>
      <option>Freizeit & Unterhaltung</option>
      <option>Bildung & Studium</option>
      <option>Technik & Elektronik</option>
      <option>Reisen</option>
      <option>Sonstiges</option>
    </select>

    <div class="row">
      <div>
        <label>Datum</label>
        <input id="datum" type="date" required />
      </div>
      <div>
        <label>Zahlungsart</label>
        <select id="zahlungsart">
          <option value="">—</option>
          <option>Karte</option>
          <option>Bar</option>
          <option>Überweisung</option>
          <option>PayPal</option>
          <option>Kreditkarte</option>
        </select>
      </div>
    </div>

    <label>Unterkategorie (optional)</label>
    <input id="unterkategorie" type="text" />

    <label>Fix/Variabel (optional)</label>
    <select id="fix_variabel">
      <option value="">—</option>
      <option>Fixkosten</option>
      <option>Variable Kosten</option>
    </select>

    <label>Notiz (optional)</label>
    <textarea id="notiz" rows="3"></textarea>

    <button type="submit">Speichern</button>
    <div class="msg" id="msg"></div>
  </form>

  <script>
    // 1) HIER eintragen:
    const ENDPOINT_URL = "PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL_HERE";
    const API_TOKEN = "CHANGE_ME_TO_A_LONG_RANDOM_TOKEN";

    // Default date = today
    document.getElementById("datum").valueAsDate = new Date();

    // Register service worker (PWA offline shell)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").catch(()=>{});
    }

    const msg = document.getElementById("msg");
    const f = document.getElementById("f");

    f.addEventListener("submit", async (ev) => {
      ev.preventDefault();
      msg.textContent = "Sende…";

      const payload = {
        token: API_TOKEN,
        typ: document.getElementById("typ").value,
        betrag: Number(document.getElementById("betrag").value),
        kategorie: document.getElementById("kategorie").value,
        unterkategorie: document.getElementById("unterkategorie").value,
        zahlungsart: document.getElementById("zahlungsart").value,
        fix_variabel: document.getElementById("fix_variabel").value,
        datum: document.getElementById("datum").value, // YYYY-MM-DD
        notiz: document.getElementById("notiz").value
      };

      try {
        const res = await fetch(ENDPOINT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(()=> ({}));

        if (!res.ok || !data.ok) throw new Error(data.error || ("HTTP " + res.status));

        msg.textContent = "Gespeichert ✅";
        // optional: nur Betrag/Notiz resetten
        document.getElementById("betrag").value = "";
        document.getElementById("unterkategorie").value = "";
        document.getElementById("notiz").value = "";
      } catch (e) {
        msg.textContent = "Fehler: " + e.message;
      }
    });
  </script>
</body>
</html>
